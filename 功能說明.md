# AIChat - 全方位 LLM 命令列工具

## 專案簡介

AIChat 是一個使用 Rust 開發的全功能 AI 助手命令列工具,提供統一介面整合超過 20 個主流 LLM 服務提供商。無論是日常對話、程式開發、Shell 操作還是文件問答,AIChat 都能提供強大的支援。

**專案資訊:**
- 版本: 0.30.0
- 授權: MIT OR Apache-2.0
- 倉庫: https://github.com/sigoden/aichat
- 語言: Rust
- 平台: macOS, Linux, Windows, Android Termux

---

## 核心功能一覽

### 1. 多 LLM 提供商支援

AIChat 整合了超過 20 個主流 AI 服務提供商,透過統一的介面即可使用:

**主流雲端服務:**
- **OpenAI** - GPT-4o, GPT-4, GPT-3.5 等系列模型
- **Anthropic Claude** - Claude 3.5 Sonnet, Claude 3 系列
- **Google Gemini** - Gemini Pro, Gemini Ultra
- **Azure OpenAI** - Microsoft Azure 上的 OpenAI 服務
- **Google VertexAI** - Google Cloud 的 AI 平台
- **AWS Bedrock** - Amazon 的 AI 模型服務

**其他提供商:**
- Groq - 超高速推理
- Mistral AI - 歐洲開源模型
- Deepseek - 深度求索
- Cohere - 企業級 NLP
- Perplexity - 搜尋增強
- Cloudflare Workers AI
- OpenRouter - 多模型聚合
- XAI Grok - X 平台 AI
- AI21 Labs
- 阿里雲通義千問
- 智譜 AI
- 月之暗面 Moonshot
- MiniMax
- 百度文心一言

**本地模型:**
- **Ollama** - 本地運行開源模型
- 任何 OpenAI 相容的 API

**配置範例:**
```yaml
clients:
  - type: openai
    api_key: sk-xxx

  - type: claude
    api_key: sk-ant-xxx

  - type: openai-compatible
    name: ollama
    api_base: http://localhost:11434/v1
```

---

### 2. 三種工作模式

#### 2.1 CMD 模式 (命令列模式)

直接在命令列執行單次 AI 對話,適合快速查詢和腳本整合。

**基本用法:**
```bash
# 直接提問
aichat "解釋什麼是遞迴"

# 從標準輸入讀取
cat error.log | aichat "分析這個錯誤日誌"

# 指定模型
aichat -m claude:claude-3-5-sonnet "寫一個排序算法"

# 包含檔案
aichat -f main.py "這段程式碼有什麼問題?"
```

**進階功能:**
```bash
# 使用角色
aichat -r code "寫一個 HTTP 伺服器"

# 開啟會話
aichat -s project "繼續討論架構設計"

# 乾運行(不實際發送請求)
aichat --dry-run "測試提示詞"
```

#### 2.2 REPL 模式 (互動式對話)

進入互動式聊天介面,提供豐富的編輯和對話功能。

**啟動方式:**
```bash
# 直接啟動
aichat

# 指定預設設定
aichat -m gpt-4o -r assistant
```

**REPL 特色功能:**

1. **智慧補全**
   - Tab 鍵自動補全命令
   - 支援檔案路徑補全
   - 歷史命令補全

2. **多行輸入**
   - 支援複雜的多行問題
   - 程式碼區塊友好

3. **歷史搜尋**
   - Ctrl+R 搜尋歷史
   - 上下鍵瀏覽歷史

4. **自訂按鍵綁定**
   ```yaml
   keybindings: emacs  # 或 vi
   ```

5. **語法高亮**
   - Markdown 語法高亮
   - 程式碼區塊高亮
   - 支援自訂主題

**REPL 內建命令:**
```bash
.help              # 顯示幫助
.info              # 顯示系統資訊
.model gpt-4o      # 切換模型
.role code         # 切換角色
.session new       # 新建會話
.session save      # 儲存會話
.clear             # 清空對話
.copy              # 複製最後回覆
.file data.txt     # 載入檔案
.exit              # 退出
```

#### 2.3 Serve 模式 (伺服器模式)

啟動本地 HTTP 伺服器,提供 API 服務和網頁介面。

**啟動伺服器:**
```bash
# 使用預設位址 127.0.0.1:8000
aichat --serve

# 指定位址
aichat --serve 0.0.0.0:3000
```

**提供的服務:**

1. **Chat Completions API** - `http://127.0.0.1:8000/v1/chat/completions`
   - OpenAI 相容的對話 API
   - 支援串流回應
   - 支援多模型切換

2. **Embeddings API** - `http://127.0.0.1:8000/v1/embeddings`
   - 文字向量化服務
   - 支援多種 embedding 模型

3. **Rerank API** - `http://127.0.0.1:8000/v1/rerank`
   - 文件重新排序服務
   - 提升檢索精度

4. **LLM Playground** - `http://127.0.0.1:8000/playground`
   - 網頁版 AI 對話介面
   - 視覺化參數調整
   - 即時測試不同模型

5. **LLM Arena** - `http://127.0.0.1:8000/arena?num=2`
   - 多模型並排比較
   - 支援盲測
   - 對比不同模型的回答

**API 使用範例:**
```bash
curl -X POST http://127.0.0.1:8000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "Hello!"}],
    "stream": true
  }'
```

---

### 3. Shell 助手

將自然語言轉換為 Shell 命令,大幅提升命令列操作效率。

**基本用法:**
```bash
# 生成命令(不執行)
aichat -c "列出所有大於 100MB 的檔案"

# 生成並執行命令
aichat -e "找出佔用 CPU 最高的前 5 個程序"
```

**智慧適應:**
- 自動偵測作業系統(Linux/macOS/Windows)
- 自動適應 Shell 類型(bash/zsh/fish/powershell)
- 生成相容當前環境的命令

**使用場景:**
```bash
# 檔案操作
aichat -e "將所有 jpg 轉換為 png"

# 系統監控
aichat -e "顯示記憶體使用率"

# Git 操作
aichat -c "建立新分支並切換"

# 網路操作
aichat -e "測試網路連線速度"

# 文字處理
aichat -e "統計程式碼行數,按語言分類"
```

**安全特性:**
- 預設不自動執行,需加 `-e` 參數
- 顯示命令供使用者確認
- 可設定需要互動確認

---

### 4. 多形式輸入支援

AIChat 支援多種靈活的輸入方式,可以組合使用。

#### 4.1 命令列參數
```bash
aichat "這是我的問題"
```

#### 4.2 標準輸入(STDIN)
```bash
# 管道輸入
echo "分析這段文字" | aichat

# 文件重導向
aichat < input.txt

# 命令輸出
git diff | aichat "解釋這些變更"
```

#### 4.3 本地檔案
```bash
# 單個檔案
aichat -f README.md "總結這份文件"

# 多個檔案
aichat -f main.py -f utils.py "重構這些程式碼"

# 圖片(Vision 模型)
aichat -f screenshot.png "描述這張圖片"
```

#### 4.4 本地目錄
```bash
# 載入整個目錄
aichat -f src/ "分析專案結構"

# 自動遍歷子目錄
aichat -f . "找出所有 TODO 註解"
```

#### 4.5 遠端 URL
```bash
# 網頁內容
aichat -f https://example.com "總結這個網頁"

# 線上文件
aichat -f https://docs.python.org/3/tutorial/ "解釋教學內容"
```

#### 4.6 外部命令輸出
```bash
# 使用反引號
aichat -f '`git log --oneline -10`' "分析最近的提交"

# 組合使用
aichat -f '`ls -la`' "清理不需要的檔案"
```

#### 4.7 組合輸入
```bash
# 檔案 + 問題
aichat -f data.json -f schema.sql "驗證資料結構"

# 多種來源
cat error.log | aichat -f config.yaml "診斷問題"

# REPL 模式組合
> .file report.pdf image.png -- 分析報告和圖表的關聯性
```

**支援的檔案格式:**
- 文字: `.txt`, `.md`, `.log`, `.csv`
- 程式碼: `.py`, `.js`, `.rs`, `.go`, `.java` 等
- 文件: `.pdf`, `.docx`(需安裝外部工具)
- 圖片: `.png`, `.jpg`, `.gif`, `.webp`(需 Vision 模型)
- 網頁: HTML 自動轉 Markdown

---

### 5. 角色系統 (Role System)

自訂 AI 的行為模式和專業領域,提升互動效率。

#### 5.1 內建角色

```bash
# 列出所有角色
aichat --list-roles

# 使用角色
aichat -r code "實作快速排序"
```

**預設內建角色:**
- `%shell%` - Shell 命令生成專家
- `%explain-shell%` - Shell 命令解釋專家
- `%code%` - 程式設計專家

#### 5.2 自訂角色

建立角色檔案: `~/.config/aichat/roles/translator.yaml`

```yaml
name: translator
description: 專業英中翻譯

# 系統提示詞
prompt: |
  你是一位專業的英中翻譯,擅長技術文件翻譯。

  翻譯規則:
  - 保持專業術語的準確性
  - 保留程式碼區塊不翻譯
  - 語氣要自然流暢
  - 保持原文的格式

# 模型設定
model: gpt-4o
temperature: 0.3

# 進階參數
top_p: 0.9
```

**角色配置選項:**
```yaml
name: 角色名稱
description: 角色描述
prompt: 系統提示詞
model: 使用的模型
temperature: 溫度(0-1)
top_p: Top-P 參數
max_tokens: 最大輸出長度
```

#### 5.3 使用場景

```bash
# 程式設計助手
aichat -r code -f main.py "加入錯誤處理"

# 翻譯助手
aichat -r translator "Translate: The quick brown fox"

# 文案助手
aichat -r copywriter "為新產品寫行銷文案"

# 資料分析
aichat -r analyst -f sales.csv "分析銷售趨勢"
```

#### 5.4 角色最佳實踐

1. **明確定義角色範圍**
   ```yaml
   prompt: |
     你是 Python 程式設計專家,專精於:
     - 後端開發(Django/Flask)
     - 資料分析(Pandas/NumPy)
     - 效能優化
   ```

2. **提供具體規則**
   ```yaml
   prompt: |
     程式碼規範:
     - 使用 Type Hints
     - 遵循 PEP 8
     - 加入完整的 docstrings
   ```

3. **設定適當參數**
   ```yaml
   temperature: 0.2  # 程式碼生成用低溫度
   temperature: 0.8  # 創意寫作用高溫度
   ```

---

### 6. 會話系統 (Session System)

保持連續對話的上下文,實現長期記憶和對話管理。

#### 6.1 基本操作

```bash
# 啟動新會話
aichat -s my-project

# 繼續現有會話
aichat -s my-project "繼續之前的討論"

# 空會話(清除歷史)
aichat -s my-project --empty-session

# 確保儲存會話
aichat -s my-project --save-session
```

#### 6.2 會話管理

```bash
# 列出所有會話
aichat --list-sessions

# REPL 中管理
.session                    # 顯示當前會話
.session new project-x      # 建立新會話
.session save               # 儲存當前會話
.session load old-project   # 載入會話
.session list               # 列出所有會話
.session delete temp        # 刪除會話
```

#### 6.3 會話配置

在 `config.yaml` 中設定:

```yaml
# 會話持久化
save_session: true  # true: 自動儲存, false: 不儲存, null: 詢問

# 壓縮閾值(token 數)
compress_threshold: 4000

# 摘要提示詞
summarize_prompt: '用 200 字以內簡潔總結對話內容'

# 摘要前綴
summary_prompt: '對話歷史摘要: '
```

#### 6.4 會話壓縮

當對話過長時,自動壓縮以節省 token:

```yaml
# 達到 4000 tokens 時觸發壓縮
compress_threshold: 4000
```

**壓縮流程:**
1. 偵測 token 數超過閾值
2. 呼叫 LLM 生成對話摘要
3. 保留摘要 + 最近對話
4. 釋放舊的對話記錄

#### 6.5 使用場景

**專案開發:**
```bash
# 第一天
aichat -s webapp "開始設計一個網站架構"

# 第二天
aichat -s webapp "繼續實作前端部分"

# 第三天
aichat -s webapp "優化效能問題"
```

**學習與研究:**
```bash
# 深入學習某個主題
aichat -s rust-learning "學習 Rust 所有權機制"
# ... 多次對話後仍保持上下文
```

**臨時會話:**
```bash
# 使用預設臨時會話
aichat -s "快速問題"
```

---

### 7. RAG (檢索增強生成)

整合外部文件,讓 AI 基於您的文件庫回答問題。

#### 7.1 建立 RAG

```bash
# 從目錄建立 RAG
aichat --rag my-docs

# 互動式加入文件
> .rag add /path/to/docs
> .rag add https://docs.example.com

# 指定檔案類型
> .rag add *.md *.txt
```

#### 7.2 使用 RAG

```bash
# 命令列模式
aichat --rag my-docs "這個專案如何部署?"

# REPL 模式
> .rag my-docs
> 解釋配置檔案的作用
```

#### 7.3 RAG 配置

在 `config.yaml` 中設定:

```yaml
# Embedding 模型
rag_embedding_model: openai:text-embedding-3-small

# Reranker 模型(可選,提升精度)
rag_reranker_model: cohere:rerank-english-v3.0

# 檢索數量
rag_top_k: 5

# 文件分塊大小(字元數)
rag_chunk_size: 1000

# 分塊重疊
rag_chunk_overlap: 200

# RAG 提示詞模板
rag_template: |
  根據以下上下文回答問題:

  <context>
  __CONTEXT__
  </context>

  <rules>
  - 如果不知道答案,直接說不知道
  - 如果不確定,要求澄清
  - 用與問題相同的語言回答
  - 直接回答,不要使用 XML 標籤
  </rules>

  <user_query>
  __INPUT__
  </user_query>
```

#### 7.4 文件載入器

自訂文件格式處理:

```yaml
document_loaders:
  # PDF 檔案
  pdf: 'pdftotext $1 -'

  # Word 文件
  docx: 'pandoc --to plain $1'

  # 自訂載入器
  custom: 'my-loader.sh $1 $2'
```

**安裝外部工具:**
```bash
# macOS
brew install poppler pandoc

# Ubuntu
apt install poppler-utils pandoc
```

#### 7.5 RAG 管理

```bash
# 列出所有 RAG
aichat --list-rags

# 重建 RAG(同步文件變更)
aichat --rag my-docs --rebuild-rag

# REPL 命令
.rag list                   # 列出 RAG
.rag my-docs                # 切換 RAG
.rag rebuild                # 重建當前 RAG
.rag add new-file.pdf       # 加入文件
```

#### 7.6 進階功能

**使用 Reranker 提升精度:**
```yaml
rag_reranker_model: cohere:rerank-multilingual-v3.0
```

**自訂分塊策略:**
```yaml
rag_chunk_size: 1500        # 較大的塊保留更多上下文
rag_chunk_overlap: 300      # 較大的重疊避免斷句
```

**多語言支援:**
- 自動偵測文件語言
- 支援程式碼智慧分塊
- 保持 Markdown 結構

#### 7.7 使用場景

**技術文件問答:**
```bash
aichat --rag project-docs "如何配置資料庫連線?"
```

**程式碼庫分析:**
```bash
aichat --rag codebase "auth 模組在哪裡實作?"
```

**研究助手:**
```bash
aichat --rag research-papers "總結關於 XXX 的最新研究"
```

---

### 8. Function Calling (函數呼叫)

連接外部工具和資料來源,大幅擴展 AI 能力。

#### 8.1 基本概念

Function Calling 讓 LLM 能夠:
- 呼叫外部工具
- 存取即時資料
- 執行系統操作
- 整合第三方服務

#### 8.2 配置 Function Calling

在 `config.yaml` 中啟用:

```yaml
# 全域啟用
function_calling: true

# 工具映射(別名)
mapping_tools:
  fs: 'fs_cat,fs_ls,fs_mkdir,fs_rm,fs_write'
  web: 'web_search,web_fetch'

# 預設使用的工具
use_tools: 'fs,web'
```

#### 8.3 內建工具範例

參考 [llm-functions](https://github.com/sigoden/llm-functions) 專案:

**檔案系統工具:**
- `fs_cat` - 讀取檔案內容
- `fs_ls` - 列出目錄
- `fs_mkdir` - 建立目錄
- `fs_rm` - 刪除檔案
- `fs_write` - 寫入檔案

**網路工具:**
- `web_search` - 網路搜尋
- `web_fetch` - 抓取網頁
- `web_scrape` - 網頁爬蟲

**系統工具:**
- `execute_command` - 執行系統命令
- `get_env` - 取得環境變數

#### 8.4 MCP (Model Context Protocol)

支援 MCP 協議整合外部服務:

```yaml
# MCP 伺服器配置
mcp_servers:
  - name: database
    command: mcp-database-server
    args: ["--db", "postgres://..."]

  - name: filesystem
    command: mcp-fs-server
    args: ["--root", "/workspace"]
```

#### 8.5 使用範例

**自動搜尋並整理資訊:**
```bash
aichat --use-tools web "搜尋最新的 Rust 1.75 更新內容並總結"
```

**檔案操作:**
```bash
aichat --use-tools fs "找出專案中所有 TODO 註解並整理成清單"
```

**多工具協作:**
```bash
aichat --use-tools fs,web "分析本地日誌檔案,搜尋錯誤原因,提供解決方案"
```

#### 8.6 自訂工具

建立工具定義檔: `~/.config/aichat/functions/tools.json`

```json
[
  {
    "name": "get_weather",
    "description": "取得指定城市的天氣資訊",
    "parameters": {
      "type": "object",
      "properties": {
        "city": {
          "type": "string",
          "description": "城市名稱"
        }
      },
      "required": ["city"]
    },
    "command": "curl",
    "args": ["https://api.weather.com?city={{city}}"]
  }
]
```

---

### 9. AI Agents

AI Agent 是指令、工具和文件的組合,可執行複雜的自動化任務。

#### 9.1 Agent 概念

**Agent = 指令(Prompt) + 工具(Tools) + 文件(RAG)**

類似 OpenAI GPTs,但在命令列中運行。

#### 9.2 建立 Agent

建立 Agent 目錄結構:
```
~/.config/aichat/agents/
└── my-agent/
    ├── config.yaml          # Agent 配置
    ├── instructions.md      # 指令說明
    └── documents/           # 文件庫(可選)
```

**config.yaml:**
```yaml
# Agent 名稱
name: code-reviewer

# 使用的模型
model: claude:claude-3-5-sonnet

# 溫度
temperature: 0.3

# 可用工具
use_tools: 'fs,git'

# 會話設定
agent_prelude: temp

# 指令(或使用 instructions.md)
instructions: |
  你是專業的程式碼審查專家。

  審查重點:
  1. 程式碼品質和可讀性
  2. 潛在的 bug 和安全問題
  3. 效能優化建議
  4. 最佳實踐遵循

  輸出格式:
  - 總體評分(1-10)
  - 主要問題列表
  - 改進建議
  - 優點總結

# 變數預設值
variables:
  language: python
  style_guide: pep8
```

**instructions.md:**
```markdown
# Code Reviewer Agent

你是專業的 {{language}} 程式碼審查專家。

## 審查標準
- 遵循 {{style_guide}} 規範
- 重視程式碼安全性
- 關注效能問題

## 審查流程
1. 理解程式碼意圖
2. 檢查潛在問題
3. 提供改進建議
4. 總結優缺點
```

#### 9.3 使用 Agent

```bash
# 列出所有 Agent
aichat --list-agents

# 啟動 Agent
aichat -a code-reviewer

# 指定變數
aichat -a code-reviewer --agent-variable language rust

# 載入檔案
aichat -a code-reviewer -f main.rs "審查這個檔案"
```

#### 9.4 Agent 範例

**研究助手:**
```yaml
name: researcher
model: gpt-4o
use_tools: web_search,web_fetch
instructions: |
  你是研究助手,擅長:
  - 搜集資訊
  - 分析資料
  - 撰寫報告

  工作流程:
  1. 搜尋相關資料
  2. 驗證資訊來源
  3. 整理成結構化報告
```

**資料分析師:**
```yaml
name: analyst
model: gpt-4o
use_tools: fs,python
instructions: |
  你是資料分析專家。

  分析步驟:
  1. 載入並檢查資料
  2. 資料清洗和預處理
  3. 統計分析
  4. 視覺化呈現
  5. 撰寫分析報告
```

**文件助手:**
```yaml
name: doc-writer
model: claude:claude-3-5-sonnet
use_tools: fs
instructions: |
  你是技術文件撰寫專家。

  文件標準:
  - 清晰的結構
  - 完整的範例
  - 實用的說明
  - 適當的圖表
```

#### 9.5 Agent 最佳實踐

1. **明確定義任務範圍**
2. **提供詳細的指令**
3. **選擇合適的工具組合**
4. **使用 RAG 提供背景知識**
5. **設定適當的模型和參數**

---

### 10. 巨集系統 (Macro System)

將常用的命令序列組合成可重複使用的巨集。

#### 10.1 建立巨集

巨集檔案位置: `~/.config/aichat/macros/`

**範例: translate.macro**
```bash
# 翻譯巨集
.role translator
.file $1
翻譯成繁體中文
```

**範例: review.macro**
```bash
# 程式碼審查巨集
.agent code-reviewer
.file $1
審查這段程式碼,重點關注:
1. 安全性
2. 效能
3. 可維護性
```

#### 10.2 使用巨集

```bash
# 執行巨集
aichat --macro translate document.txt

# 帶參數
aichat --macro review src/main.rs

# 列出所有巨集
aichat --list-macros
```

#### 10.3 巨集變數

```bash
# $1, $2, $3... 代表位置參數
# $@ 代表所有參數

# 範例
.role code
.file $1 $2
重構這些檔案,目標: $3
```

使用:
```bash
aichat --macro refactor main.py utils.py "提升可讀性"
```

#### 10.4 實用巨集範例

**每日總結:**
```bash
# daily-summary.macro
.session daily
.file '`git log --since="1 day ago" --pretty=format:"%s"`'
總結今天的工作內容
```

**錯誤診斷:**
```bash
# diagnose.macro
.role troubleshooter
.file $1
.file '`uname -a`'
分析錯誤日誌並提供解決方案
```

**文件生成:**
```bash
# doc-gen.macro
.role doc-writer
.file $1
為這個模組生成完整的 API 文件
```

---

### 11. 渲染與顯示

#### 11.1 語法高亮

自動高亮程式碼區塊:

```yaml
# 啟用高亮
highlight: true

# 亮/暗主題
light_theme: false
```

支援的語言:
- Python, JavaScript, TypeScript, Rust, Go, Java
- C, C++, C#, Ruby, PHP, Swift, Kotlin
- HTML, CSS, SQL, Shell, Markdown
- 還有更多...

#### 11.2 自訂主題

建立主題檔案: `~/.config/aichat/themes/my-theme.yaml`

```yaml
# 深色主題範例
name: my-dark-theme
light: false

colors:
  background: "#1e1e1e"
  foreground: "#d4d4d4"

  # 語法元素
  keyword: "#569cd6"
  string: "#ce9178"
  comment: "#6a9955"
  function: "#dcdcaa"
  variable: "#9cdcfe"

  # UI 元素
  prompt: "#00ff00"
  error: "#f44747"
  warning: "#ff8800"
```

使用主題:
```yaml
# config.yaml
theme: my-dark-theme
```

#### 11.3 文字換行

```yaml
# 不換行
wrap: no

# 自動換行
wrap: auto

# 固定寬度
wrap: 80
```

#### 11.4 自訂 REPL 提示符

```yaml
# 左側提示符
left_prompt: |
  {color.green}{?session {session}>}{role}{color.cyan}>{color.reset}

# 右側提示符
right_prompt: |
  {color.purple}{consume_tokens}({consume_percent}%){color.reset}
```

**可用變數:**
- `{role}` - 當前角色
- `{session}` - 當前會話
- `{agent}` - 當前 Agent
- `{rag}` - 當前 RAG
- `{model}` - 當前模型
- `{consume_tokens}` - 已使用 tokens
- `{consume_percent}` - 使用百分比

**顏色:**
- `{color.red}`, `{color.green}`, `{color.blue}`
- `{color.cyan}`, `{color.yellow}`, `{color.purple}`
- `{color.reset}` - 重設顏色

---

### 12. 其他功能

#### 12.1 模型管理

```bash
# 列出所有可用模型
aichat --list-models

# 同步模型定義
aichat --sync-models

# 使用特定模型
aichat -m gpt-4o "你好"
```

**模型選擇語法:**
```bash
# 提供商:模型名稱
-m openai:gpt-4o
-m claude:claude-3-5-sonnet
-m gemini:gemini-pro

# 簡短形式(需要唯一)
-m gpt-4o
-m claude-3-5-sonnet
```

#### 12.2 串流控制

```yaml
# 預設啟用串流
stream: true
```

```bash
# 關閉串流
aichat -S "問題"
aichat --no-stream "問題"
```

#### 12.3 訊息持久化

```yaml
# 儲存所有訊息
save: true
```

訊息儲存位置: `~/.config/aichat/messages/`

#### 12.4 編輯器整合

```yaml
# 指定編輯器
editor: vim

# 或使用環境變數
# export EDITOR=code
```

在 REPL 中按 `Ctrl+O` 開啟編輯器。

#### 12.5 剪貼簿整合

```bash
# REPL 命令
.copy              # 複製最後的回覆
```

#### 12.6 代理伺服器

```yaml
clients:
  - type: openai
    api_key: xxx
    extra:
      proxy: socks5://127.0.0.1:1080
      connect_timeout: 10
```

#### 12.7 日誌記錄

```yaml
# 儲存 Shell 執行歷史
save_shell_history: true
```

日誌位置: `~/.config/aichat/history`

#### 12.8 乾運行模式

```bash
# 顯示請求但不發送
aichat --dry-run "測試提示詞"
```

用途:
- 測試提示詞
- 檢查 token 使用
- 除錯配置

---

## 安裝方式

### 套件管理器

```bash
# Rust 開發者
cargo install aichat

# Homebrew (macOS/Linux)
brew install aichat

# Arch Linux
pacman -S aichat

# Windows Scoop
scoop install aichat

# Android Termux
pkg install aichat
```

### 預編譯二進位

從 [GitHub Releases](https://github.com/sigoden/aichat/releases) 下載適合您系統的版本。

---

## 配置檔案

### 主配置檔案

位置: `~/.config/aichat/config.yaml`

參考 `config.example.yaml` 建立您的配置。

### 配置結構

```
~/.config/aichat/
├── config.yaml              # 主配置
├── roles/                   # 角色定義
│   ├── coder.yaml
│   └── translator.yaml
├── agents/                  # Agent 定義
│   ├── researcher/
│   └── analyst/
├── macros/                  # 巨集檔案
│   ├── translate.macro
│   └── review.macro
├── functions/               # 函數定義
│   └── tools.json
├── themes/                  # 自訂主題
│   └── my-theme.yaml
└── sessions/                # 會話儲存
    ├── project-a.yaml
    └── project-b.yaml
```

### 環境變數

```bash
# 配置目錄
export AICHAT_CONFIG_DIR=~/.config/aichat

# API Keys
export OPENAI_API_KEY=sk-xxx
export ANTHROPIC_API_KEY=sk-ant-xxx
export GEMINI_API_KEY=xxx

# 代理
export HTTPS_PROXY=http://127.0.0.1:7890

# 主題
export AICHAT_LIGHT_THEME=true
```

---

## 使用場景範例

### 1. 日常開發

```bash
# 快速查詢
aichat "Rust 中如何處理錯誤?"

# 程式碼審查
aichat -f main.rs "這段程式碼有什麼問題?"

# 生成測試
aichat -r code -f src/lib.rs "為這個模組寫單元測試"

# Git 操作
aichat -e "提交所有變更並推送"
```

### 2. 學習新技術

```bash
# 開啟學習會話
aichat -s rust-learning

# 持續學習
> 解釋 Rust 的所有權機制
> 給我一個範例
> 這和 C++ 的 RAII 有什麼不同?
> ...
```

### 3. 文件處理

```bash
# 建立文件庫
aichat --rag project-docs
> .rag add docs/ README.md

# 問答
aichat --rag project-docs "部署流程是什麼?"
```

### 4. 自動化任務

```bash
# 使用 Agent
aichat -a data-processor -f data.csv "清洗資料並生成報告"

# 使用巨集
aichat --macro daily-report
```

### 5. 多模型比較

```bash
# 啟動 Arena
aichat --serve
# 瀏覽器開啟 http://localhost:8000/arena?num=3
```

---

## 進階技巧

### 1. 管道操作

```bash
# 錯誤診斷管道
tail -f app.log | grep ERROR | aichat "分析並提供解決方案"

# 程式碼統計
find . -name "*.rs" | xargs cat | aichat "統計程式碼行數和複雜度"
```

### 2. 腳本整合

```bash
#!/bin/bash
# auto-commit.sh

diff=$(git diff)
if [ -n "$diff" ]; then
    message=$(echo "$diff" | aichat "生成簡潔的 commit message")
    git add .
    git commit -m "$message"
fi
```

### 3. 工作流程自動化

```bash
# .bashrc 或 .zshrc
alias explain='aichat -r explain-shell'
alias commit='git diff | aichat "生成 commit message"'
alias review='aichat -a code-reviewer -f'
```

### 4. 組合使用

```bash
# RAG + Agent + Session
aichat \
  -s my-project \
  -a developer \
  --rag project-docs \
  -f src/ \
  "根據文件重構這個模組"
```

---

## 效能優化

### 1. 模型選擇

```yaml
# 快速回應
model: gpt-4o-mini

# 平衡效能
model: gpt-4o

# 最佳品質
model: claude:claude-3-5-sonnet
```

### 2. Token 優化

```yaml
# 啟用壓縮
compress_threshold: 4000

# 限制輸出長度
max_tokens: 2000
```

### 3. 本地模型

```yaml
# 使用 Ollama
clients:
  - type: openai-compatible
    name: ollama
    api_base: http://localhost:11434/v1

model: ollama:llama3.1
```

---

## 安全性

### 1. API Key 管理

```bash
# 使用環境變數
export OPENAI_API_KEY=sk-xxx

# 或使用配置檔案權限
chmod 600 ~/.config/aichat/config.yaml
```

### 2. 敏感資料

```yaml
# 不儲存敏感會話
save_session: false

# 或使用臨時會話
aichat -s temp "處理敏感資料"
```

### 3. 工具權限

```yaml
# 限制工具使用
use_tools: 'fs_read,web_search'  # 只允許讀取和搜尋
```

---

## 疑難排解

### 常見問題

1. **無法連線 API**
   ```bash
   # 檢查代理設定
   export HTTPS_PROXY=http://127.0.0.1:7890

   # 測試連線
   aichat --info
   ```

2. **Token 超限**
   ```yaml
   # 啟用壓縮
   compress_threshold: 3000

   # 或使用更大上下文的模型
   model: claude:claude-3-5-sonnet  # 200K context
   ```

3. **編碼問題**
   ```bash
   # 設定 locale
   export LANG=zh_TW.UTF-8
   ```

4. **RAG 建立失敗**
   ```bash
   # 檢查文件載入器
   pdftotext -v
   pandoc --version
   ```

---

## 社群與支援

- **GitHub**: https://github.com/sigoden/aichat
- **Discord**: https://discord.gg/mr3ZZUB9hG
- **Wiki**: https://github.com/sigoden/aichat/wiki
- **問題回報**: https://github.com/sigoden/aichat/issues

---

## 授權

本專案採用雙授權:
- MIT License
- Apache License 2.0

您可以選擇其中一種授權方式使用。

---

## 總結

AIChat 是一個功能豐富、設計優雅的 LLM CLI 工具,提供:

- ✅ 統一的多提供商介面
- ✅ 靈活的工作模式(CMD/REPL/Serve)
- ✅ 強大的會話和角色系統
- ✅ RAG 檢索增強
- ✅ Function Calling 工具整合
- ✅ AI Agents 自動化
- ✅ 豐富的自訂選項

無論您是開發者、研究人員還是普通使用者,AIChat 都能大幅提升您與 AI 互動的效率。

立即開始使用,體驗命令列的 AI 強大功能!
