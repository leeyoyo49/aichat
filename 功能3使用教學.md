# åŠŸèƒ½ 3ï¼šå®‰å…¨åŸ·è¡Œæ¨¡å¼ - è©³ç´°ä½¿ç”¨æ•™å­¸

## ğŸ¯ é€™å€‹åŠŸèƒ½æ˜¯åšä»€éº¼çš„ï¼Ÿ

### ç°¡å–®ä¾†èªª
ç•¶ä½ è®“ AI ç”Ÿæˆ Shell å‘½ä»¤æ™‚ï¼ŒåŠŸèƒ½ 3 æœƒï¼š
- âœ… å‘Šè¨´ä½ é€™å€‹å‘½ä»¤å®‰ä¸å®‰å…¨
- âœ… é¡¯ç¤ºæœƒå½±éŸ¿å“ªäº›æª”æ¡ˆ
- âœ… è§£é‡‹å‘½ä»¤çš„æ¯å€‹éƒ¨åˆ†
- âœ… åŸ·è¡Œå‰è‡ªå‹•å‚™ä»½
- âœ… å‡ºéŒ¯æ™‚å¯ä»¥ä¸€éµé‚„åŸ

### ç‚ºä»€éº¼éœ€è¦é€™å€‹åŠŸèƒ½ï¼Ÿ

**å•é¡Œå ´æ™¯ï¼š**
```bash
# ä½ å• AIï¼šå¦‚ä½•åˆªé™¤èˆŠæª”æ¡ˆï¼Ÿ
# AI å›ç­”ï¼šrm -rf /var/log/*

# ğŸ˜± å±éšªï¼å¦‚æœä½ ç›´æ¥åŸ·è¡Œï¼š
# - ä¸çŸ¥é“æœƒåˆªé™¤å“ªäº›æª”æ¡ˆ
# - ä¸çŸ¥é“é€™å€‹å‘½ä»¤æ˜¯ä»€éº¼æ„æ€
# - åˆªé™¤å¾Œç„¡æ³•å¾©åŸ
# - å¯èƒ½èª¤åˆªé‡è¦æª”æ¡ˆ
```

**æœ‰äº†åŠŸèƒ½ 3ï¼š**
```bash
# ä½ åŸ·è¡Œï¼šai -e "åˆªé™¤èˆŠçš„ log æª”æ¡ˆ"
# AI ç”Ÿæˆï¼šrm /var/log/*.log

# âœ… Previewï¼šé¡¯ç¤ºæœƒåˆªé™¤ app.log, error.log, debug.log
# âœ… Tutorï¼šè§£é‡‹ rm æ˜¯åˆªé™¤ï¼Œ*.log æ˜¯æ‰€æœ‰ log æª”æ¡ˆ
# âœ… Executeï¼šè‡ªå‹•å‚™ä»½é€™äº›æª”æ¡ˆå†åˆªé™¤
# âœ… å¦‚æœå¾Œæ‚”ï¼š.backup restore ç«‹å³é‚„åŸ
```

---

## ğŸš€ å¯¦éš›æ“ä½œæ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¸âƒ£ï¼šæº–å‚™æ¸¬è©¦ç’°å¢ƒ

```bash
# å»ºç«‹æ¸¬è©¦ç›®éŒ„
mkdir -p /tmp/aichat-demo
cd /tmp/aichat-demo

# å»ºç«‹ä¸€äº›æ¸¬è©¦æª”æ¡ˆ
echo "æ¸¬è©¦è³‡æ–™ 1" > file1.txt
echo "æ¸¬è©¦è³‡æ–™ 2" > file2.txt
echo "é‡è¦è³‡æ–™" > important.txt
echo "æ—¥èªŒ 1" > app.log
echo "æ—¥èªŒ 2" > error.log

# ç¢ºèªæª”æ¡ˆå­˜åœ¨
ls -la
```

### æ­¥é©Ÿ 2ï¸âƒ£ï¼šä½¿ç”¨ Execute æ¨¡å¼ï¼ˆ-e åƒæ•¸ï¼‰

```bash
# è¨­å®šåˆ¥åä»¥æ–¹ä¾¿ä½¿ç”¨
alias ai='/Users/morrisliao/Desktop/git-repo/aichat/aichat/target/release/aichat'

# åŸ·è¡Œå‘½ä»¤
cd /tmp/aichat-demo
ai -e "åˆªé™¤æ‰€æœ‰ txt æª”æ¡ˆ"
```

**æ­¤æ™‚ç•«é¢æœƒé¡¯ç¤ºï¼š**
```
ls *.txt
[p]review | [e]xecute | [r]evise | [t]utor | [c]opy | [q]uit: _
```

### æ­¥é©Ÿ 3ï¸âƒ£ï¼šé¸æ“‡æ“ä½œ

#### é¸é … Aï¼šPreviewï¼ˆé è¦½å½±éŸ¿ï¼‰

**æŒ‰ä¸‹ `p` éµ**

```
ğŸ“Š Command Analysis
==================
Command: rm *.txt
Operation: Delete
Safety Level: Dangerous

Affected Files:
  1. [âœ“] /tmp/aichat-demo/file1.txt
  2. [âœ“] /tmp/aichat-demo/file2.txt
  3. [âœ“] /tmp/aichat-demo/important.txt

âš ï¸  DANGEROUS: This operation cannot be easily undone!
âœ“ Backup will be created automatically before execution.

[p]review | [e]xecute | [r]evise | [t]utor | [c]opy | [q]uit: _
```

**ç”¨é€”ï¼š** åœ¨åŸ·è¡Œå‰å…ˆçœ‹çœ‹æœƒå½±éŸ¿å“ªäº›æª”æ¡ˆï¼Œé¿å…èª¤åˆª

---

#### é¸é … Bï¼šTutorï¼ˆå­¸ç¿’æ¨¡å¼ï¼‰

**æŒ‰ä¸‹ `t` éµ**

```
ğŸ“š Command Tutorial
===================
Command: rm *.txt

Structure Breakdown:
  â–¶ï¸ rm              - Remove (delete) files or directories
  ğŸš© *.txt           - Wildcard pattern matching all .txt files

What this command does:
  Deletes all files in the current directory that end with .txt

Environment Context:
  Current OS: MacOS
  Current Shell: Zsh
  Package Manager: Homebrew

Safety Notes:
  âš ï¸  CAUTION: Wildcard in rm command - verify files first!
  ğŸ’¡ Consider using -i flag for interactive confirmation
  ğŸ’¡ Alternative: trash *.txt (if trash-cli is installed)

Examples:
  rm -i *.txt        # Ask for confirmation before each deletion
  rm -v *.txt        # Show what is being deleted (verbose)
  ls *.txt           # Preview files before deleting

[p]review | [e]xecute | [r]evise | [t]utor | [c]opy | [q]uit: _
```

**ç”¨é€”ï¼š** å­¸ç¿’é€™å€‹å‘½ä»¤çš„ç”¨æ³•ï¼Œäº†è§£æ¯å€‹åƒæ•¸çš„æ„ç¾©

---

#### é¸é … Cï¼šExecuteï¼ˆåŸ·è¡Œï¼‰

**æŒ‰ä¸‹ `e` éµ**

```
âœ“ Backup created: f8e961a3-b4c2-4d8f-9e7a-1234567890ab
Executing: rm *.txt
âœ“ Command executed successfully

Files deleted:
  - file1.txt
  - file2.txt
  - important.txt
```

**è‡ªå‹•ç™¼ç”Ÿçš„äº‹æƒ…ï¼š**
1. ç³»çµ±è‡ªå‹•è­˜åˆ¥æœƒè¢«å½±éŸ¿çš„æª”æ¡ˆ
2. å»ºç«‹å‚™ä»½åˆ° `~/.aichat_backups/`
3. ç”Ÿæˆå”¯ä¸€çš„å‚™ä»½ ID
4. åŸ·è¡Œå‘½ä»¤
5. å¦‚æœå¤±æ•—ï¼Œé¡¯ç¤ºå¾©åŸæŒ‡ä»¤

**å¦‚æœåŸ·è¡Œå¤±æ•—ï¼š**
```
âš  Command failed with exit code 1
âš  Command failed! To restore backup, run:
  .backup restore f8e961a3-b4c2-4d8f-9e7a-1234567890ab
```

---

#### é¸é … Dï¼šReviseï¼ˆä¿®æ”¹å‘½ä»¤ï¼‰

**æŒ‰ä¸‹ `r` éµ**

```
Enter your revision: _
```

ä½ å¯ä»¥è¼¸å…¥ä¿®æ”¹å»ºè­°ï¼ŒAI æœƒé‡æ–°ç”Ÿæˆå‘½ä»¤ã€‚

**ç¯„ä¾‹ï¼š**
```
Enter your revision: åªåˆªé™¤ file1.txt å’Œ file2.txtï¼Œä¿ç•™ important.txt
```

AI æœƒç”Ÿæˆæ–°å‘½ä»¤ï¼š
```
rm file1.txt file2.txt
[p]review | [e]xecute | [r]evise | [t]utor | [c]opy | [q]uit: _
```

---

#### é¸é … Eï¼šCopyï¼ˆè¤‡è£½ï¼‰

**æŒ‰ä¸‹ `c` éµ**

å‘½ä»¤æœƒè¢«è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼Œä½ å¯ä»¥æ‰‹å‹•è²¼åˆ°çµ‚ç«¯æ©ŸåŸ·è¡Œã€‚

---

#### é¸é … Fï¼šQuitï¼ˆå–æ¶ˆï¼‰

**æŒ‰ä¸‹ `q` éµ**

å–æ¶ˆåŸ·è¡Œï¼Œä»€éº¼éƒ½ä¸åšã€‚

---

## ğŸ”„ å¦‚ä½•å¾©åŸå·²åŸ·è¡Œçš„å‘½ä»¤

### æ–¹æ³• 1ï¼šåœ¨åŸ·è¡Œå¤±æ•—æ™‚ç›´æ¥å¾©åŸ

å¦‚æœå‘½ä»¤åŸ·è¡Œå¤±æ•—ï¼Œç³»çµ±æœƒé¡¯ç¤ºï¼š
```bash
.backup restore f8e961a3-b4c2-4d8f-9e7a-1234567890ab
```

ç›´æ¥è¤‡è£½åŸ·è¡Œé€™å€‹å‘½ä»¤å³å¯ã€‚

### æ–¹æ³• 2ï¼šåœ¨ REPL ä¸­ç®¡ç†å‚™ä»½

```bash
# å•Ÿå‹• REPL
ai

# åˆ—å‡ºæ‰€æœ‰å‚™ä»½
> .backup list

# é¡¯ç¤ºçµæœï¼š
ğŸ“¦ Backup History
================================================================================

[1] ID: f8e961a3-b4c2-4d8f-9e7a-1234567890ab
    Time: 2025-12-05T15:30:00+08:00
    Command: rm *.txt
    Files backed up: 3
      - /tmp/aichat-demo/file1.txt
      - /tmp/aichat-demo/file2.txt
      - /tmp/aichat-demo/important.txt

[2] ID: a1b2c3d4-e5f6-7890-1234-567890abcdef
    Time: 2025-12-05T14:15:00+08:00
    Command: mv old.txt archive/
    Files backed up: 1
      - /tmp/test/old.txt

================================================================================
Usage: .backup restore <id> | .backup delete <id> | .backup cleanup [count]

# å¾©åŸç¬¬ä¸€å€‹å‚™ä»½
> .backup restore f8e961a3-b4c2-4d8f-9e7a-1234567890ab

âœ“ Restored: /tmp/aichat-demo/file1.txt
âœ“ Restored: /tmp/aichat-demo/file2.txt
âœ“ Restored: /tmp/aichat-demo/important.txt
âœ“ Backup restored successfully!

# é©—è­‰æª”æ¡ˆå·²å¾©åŸ
> .exit

$ cd /tmp/aichat-demo
$ ls -la
# æª”æ¡ˆéƒ½å›ä¾†äº†ï¼
```

### æ–¹æ³• 3ï¼šåˆªé™¤ä¸éœ€è¦çš„å‚™ä»½

```bash
ai

# åˆªé™¤å–®å€‹å‚™ä»½
> .backup delete a1b2c3d4-e5f6-7890-1234-567890abcdef
âœ“ Backup deleted successfully

# åªä¿ç•™æœ€è¿‘ 20 å€‹å‚™ä»½
> .backup cleanup 20
âœ“ Cleaned up 5 old backups
âœ“ Kept 20 most recent backups
```

---

## ğŸ“ å®Œæ•´å¯¦æˆ°ç¯„ä¾‹

### ç¯„ä¾‹ 1ï¼šå®‰å…¨åˆªé™¤æª”æ¡ˆ

```bash
# 1. å»ºç«‹æ¸¬è©¦ç’°å¢ƒ
mkdir -p /tmp/safe-delete-test
cd /tmp/safe-delete-test
echo "data" > test1.txt
echo "data" > test2.txt
echo "important" > keep.txt

# 2. ä½¿ç”¨ AI ç”Ÿæˆåˆªé™¤å‘½ä»¤
ai -e "åˆªé™¤ test é–‹é ­çš„ txt æª”æ¡ˆ"

# 3. AI ç”Ÿæˆï¼šrm test*.txt

# 4. æŒ‰ 'p' é è¦½
# é¡¯ç¤ºï¼šæœƒåˆªé™¤ test1.txt, test2.txt
# ä¸æœƒåˆªé™¤ keep.txt âœ“

# 5. ç¢ºèªç„¡èª¤å¾ŒæŒ‰ 'e' åŸ·è¡Œ
# ç³»çµ±è‡ªå‹•å‚™ä»½ä¸¦åŸ·è¡Œ

# 6. å¦‚æœå¾Œæ‚”ï¼ŒåŸ·è¡Œå¾©åŸ
ai
> .backup list
> .backup restore <å‰›æ‰çš„ID>
```

### ç¯„ä¾‹ 2ï¼šå­¸ç¿’è¤‡é›œå‘½ä»¤

```bash
# ä½ æƒ³å­¸ç¿’å¦‚ä½•æ‰¾å‡ºå¤§æª”æ¡ˆ
ai -e "æ‰¾å‡ºå¤§æ–¼ 100MB çš„æª”æ¡ˆ"

# AI ç”Ÿæˆï¼šfind . -type f -size +100M -exec ls -lh {} \;

# æŒ‰ 't' é€²å…¥æ•™å­¸æ¨¡å¼
# ç³»çµ±æœƒè©³ç´°è§£é‡‹ï¼š
#   find .              - å¾ç•¶å‰ç›®éŒ„æœå°‹
#   -type f             - åªæ‰¾æª”æ¡ˆï¼ˆä¸å«ç›®éŒ„ï¼‰
#   -size +100M         - å¤§å°å¤§æ–¼ 100MB
#   -exec ls -lh {} \;  - å°æ¯å€‹æ‰¾åˆ°çš„æª”æ¡ˆåŸ·è¡Œ ls -lh

# å­¸ç¿’å®Œæˆå¾ŒæŒ‰ 'c' è¤‡è£½å‘½ä»¤
# è‡ªå·±æ‰‹å‹•åŸ·è¡Œçœ‹çœ‹æ•ˆæœ
```

### ç¯„ä¾‹ 3ï¼šç’°å¢ƒç›¸é—œå‘½ä»¤

```bash
# åœ¨ macOS ä¸Š
ai -e "å®‰è£ Python"

# AI æœƒæ ¹æ“šä½ çš„ç’°å¢ƒç”Ÿæˆï¼š
# brew install python3
# (è€Œä¸æ˜¯ apt install python3)

# æŒ‰ 't' æŸ¥çœ‹
# ç³»çµ±æœƒé¡¯ç¤ºï¼š
#   Environment: MacOS
#   Package Manager: Homebrew
#   Command: brew install python3
```

---

## â“ å¸¸è¦‹å•é¡Œ

### Q1: åŠŸèƒ½ 3 åªèƒ½åœ¨ Execute æ¨¡å¼ (-e) ä½¿ç”¨å—ï¼Ÿ

**ç­”ï¼š** æ˜¯çš„ï¼Œä¸»è¦åŠŸèƒ½ï¼ˆPreview/Tutorï¼‰åªåœ¨ `-e` æ¨¡å¼ä¸­å¯ç”¨ã€‚

ä½† `.backup` å‘½ä»¤å¯ä»¥åœ¨ REPL ä¸­éš¨æ™‚ä½¿ç”¨ä¾†ç®¡ç†å‚™ä»½ã€‚

### Q2: å‚™ä»½æœƒä½”ç”¨å¾ˆå¤šç©ºé–“å—ï¼Ÿ

**ç­”ï¼š** å‚™ä»½åªæœƒä¿å­˜å—å½±éŸ¿çš„æª”æ¡ˆï¼Œè€Œä¸”å¯ä»¥éš¨æ™‚æ¸…ç†ï¼š

```bash
# åªä¿ç•™æœ€è¿‘ 50 å€‹å‚™ä»½
> .backup cleanup 50

# åˆªé™¤ç‰¹å®šå‚™ä»½
> .backup delete <ID>
```

### Q3: å¦‚æœæˆ‘ä¸æƒ³è‡ªå‹•å‚™ä»½æ€éº¼è¾¦ï¼Ÿ

**ç­”ï¼š** é¸æ“‡ `c` (copy) è¤‡è£½å‘½ä»¤ï¼Œç„¶å¾Œæ‰‹å‹•åŸ·è¡Œå³å¯ã€‚

### Q4: Preview èƒ½æª¢æ¸¬æ‰€æœ‰å±éšªå‘½ä»¤å—ï¼Ÿ

**ç­”ï¼š** èƒ½æª¢æ¸¬å¤§éƒ¨åˆ†å¸¸è¦‹çš„å±éšªæ“ä½œï¼š
- âœ… rmï¼ˆåˆªé™¤ï¼‰
- âœ… mvï¼ˆç§»å‹•ï¼‰
- âœ… >ï¼ˆè¦†å¯«ï¼‰
- âœ… sudoï¼ˆç³»çµ±æ¬Šé™ï¼‰
- âœ… chmodï¼ˆæ¬Šé™ä¿®æ”¹ï¼‰

ä½†è¤‡é›œçš„è…³æœ¬æˆ–ç®¡é“å‘½ä»¤å¯èƒ½ç„¡æ³•å®Œå…¨åˆ†æã€‚

### Q5: å‚™ä»½æª”æ¡ˆå­˜åœ¨å“ªè£¡ï¼Ÿ

**ç­”ï¼š** `~/.aichat_backups/`

çµæ§‹ï¼š
```
~/.aichat_backups/
â”œâ”€â”€ backup_index.json                    # ç´¢å¼•æª”æ¡ˆ
â”œâ”€â”€ f8e961a3-b4c2-4d8f-9e7a-.../        # å‚™ä»½ 1
â”‚   â”œâ”€â”€ file1.txt
â”‚   â””â”€â”€ file2.txt
â””â”€â”€ a1b2c3d4-e5f6-7890-1234-.../        # å‚™ä»½ 2
    â””â”€â”€ important.txt
```

---

## ğŸ¯ æœ€ä½³ä½¿ç”¨å»ºè­°

### å»ºè­° 1ï¼šé¤Šæˆä½¿ç”¨ Preview çš„ç¿’æ…£

å°æ–¼ä»»ä½•ç ´å£æ€§æ“ä½œï¼Œå…ˆæŒ‰ `p` æŸ¥çœ‹å½±éŸ¿ï¼š
- åˆªé™¤æª”æ¡ˆå‰
- ç§»å‹•æª”æ¡ˆå‰
- ä¿®æ”¹æª”æ¡ˆå‰

### å»ºè­° 2ï¼šç”¨ Tutor å­¸ç¿’æ–°å‘½ä»¤

é‡åˆ°ä¸ç†Ÿæ‚‰çš„å‘½ä»¤ï¼ŒæŒ‰ `t` å­¸ç¿’ï¼š
- äº†è§£æ¯å€‹åƒæ•¸çš„æ„ç¾©
- å­¸ç¿’ç›¸é—œçš„æ›¿ä»£å‘½ä»¤
- æŸ¥çœ‹å®‰å…¨æ³¨æ„äº‹é …

### å»ºè­° 3ï¼šå®šæœŸæ¸…ç†å‚™ä»½

é¿å…å‚™ä»½ä½”ç”¨éå¤šç©ºé–“ï¼š
```bash
# æ¯é€±åŸ·è¡Œä¸€æ¬¡
ai
> .backup cleanup 50
```

### å»ºè­° 4ï¼šé‡è¦æ“ä½œå‰æ‰‹å‹•é©—è­‰

å³ä½¿æœ‰å‚™ä»½ï¼Œé‡è¦æ“ä½œå‰é‚„æ˜¯è¦ï¼š
1. æŒ‰ `p` é è¦½
2. æŒ‰ `t` ç¢ºèªå‘½ä»¤æ­£ç¢º
3. æŒ‰ `e` åŸ·è¡Œ
4. è¨˜ä¸‹å‚™ä»½ ID

---

## ğŸš¦ å¿«é€Ÿä¸Šæ‰‹

**30 ç§’æ¸¬è©¦åŠŸèƒ½ 3ï¼š**

```bash
# 1. å»ºç«‹æ¸¬è©¦æª”æ¡ˆ
cd /tmp
echo "test" > test.txt

# 2. åŸ·è¡Œ AI å‘½ä»¤
/Users/morrisliao/Desktop/git-repo/aichat/aichat/target/release/aichat -e "delete test.txt"

# 3. æŒ‰ 'p' æŸ¥çœ‹é è¦½
# 4. æŒ‰ 't' æŸ¥çœ‹æ•™å­¸
# 5. æŒ‰ 'e' åŸ·è¡Œï¼ˆæœƒè‡ªå‹•å‚™ä»½ï¼‰
# 6. é€²å…¥ REPL å¾©åŸ
/Users/morrisliao/Desktop/git-repo/aichat/aichat/target/release/aichat
> .backup list
> .backup restore <ID>
> .exit

# 7. é©—è­‰æª”æ¡ˆå·²å¾©åŸ
ls test.txt
```

---

## ğŸ“š ç¸½çµ

**åŠŸèƒ½ 3 çš„æ ¸å¿ƒåƒ¹å€¼ï¼š**

1. **å®‰å…¨** - Preview è®“ä½ çŸ¥é“æœƒç™¼ç”Ÿä»€éº¼
2. **æ•™è‚²** - Tutor è®“ä½ å­¸ç¿’å‘½ä»¤ç”¨æ³•
3. **å¯å¾©åŸ** - è‡ªå‹•å‚™ä»½è®“ä½ ä¸æ€•å‡ºéŒ¯
4. **ç’°å¢ƒæ„ŸçŸ¥** - è‡ªå‹•é©æ‡‰ä½ çš„ç³»çµ±

**ä½•æ™‚ä½¿ç”¨ï¼š**
- âŒ ä¸€èˆ¬å°è©±ï¼šä¸é©ç”¨
- âŒ REPL æ¨¡å¼ï¼šåªæœ‰ `.backup` å‘½ä»¤å¯ç”¨
- âœ… Execute æ¨¡å¼ (`-e`)ï¼šå®Œæ•´åŠŸèƒ½å¯ç”¨
- âœ… éœ€è¦åŸ·è¡Œ Shell å‘½ä»¤æ™‚
- âœ… ä¸ç¢ºå®šå‘½ä»¤æ˜¯å¦å®‰å…¨æ™‚
- âœ… æƒ³å­¸ç¿’æ–°å‘½ä»¤æ™‚

**ç«‹å³é–‹å§‹ï¼š**
```bash
alias ai='/Users/morrisliao/Desktop/git-repo/aichat/aichat/target/release/aichat'
ai -e "ä½ çš„å‘½ä»¤éœ€æ±‚"
```

ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰
